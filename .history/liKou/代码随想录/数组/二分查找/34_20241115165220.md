# 34.åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½®
**é¢˜ç›®æè¿°**

ç»™å®šä¸€ä¸ªæŒ‰ç…§å‡åºæ’åˆ—çš„æ•´æ•°æ•°ç»„ numsï¼Œå’Œä¸€ä¸ªç›®æ ‡å€¼ targetã€‚æ‰¾å‡ºç»™å®šç›®æ ‡å€¼åœ¨æ•°ç»„ä¸­çš„å¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®ã€‚å¦‚æœæ•°ç»„ä¸­ä¸å­˜åœ¨ç›®æ ‡å€¼ targetï¼Œè¿”å› [-1, -1]ã€‚

è¿›é˜¶ï¼šä½ å¯ä»¥è®¾è®¡å¹¶å®ç°æ—¶é—´å¤æ‚åº¦ä¸º $O(\log n)$ çš„ç®—æ³•è§£å†³æ­¤é—®é¢˜å—ï¼Ÿ

ç¤ºä¾‹ 1ï¼š

> è¾“å…¥ï¼šnums = [5,7,7,8,8,10], target = 8
> 
> è¾“å‡ºï¼š[3,4]

ç¤ºä¾‹ 2ï¼š

> è¾“å…¥ï¼šnums = [5,7,7,8,8,10], target = 6
> 
> è¾“å‡ºï¼š[-1,-1]

ç¤ºä¾‹ 3ï¼š

> è¾“å…¥ï¼šnums = [], target = 0
> 
> è¾“å‡ºï¼š[-1,-1]

## é¦–æ¬¡è§£ç­”

ğŸ˜ä¸é€šè¿‡ğŸ˜  

```c

// æš´åŠ›æ³•
int* searchRange(int* nums, int numsSize, int target, int* returnSize) {
    // minå’Œmaxåˆ†åˆ«è®°å½•æ•°ç»„ä¸­å°äºtargetçš„æœ€å¤§æ•°å’Œå¤§äºtargetçš„æœ€å°æ•°çš„ä½ç½®
    int min = 0;
    int max = numsSize - 1;
    // å®šä¹‰è¿”å›æ•°ç»„åŠæ•°ç»„å¤§å°
    *returnSize = 2;
    int *ans = (int*)malloc(sizeof(int) * 2);
    if (numsSize == 0 || numsSize == 1) {
        ans[0] = -1;
        ans[1] = -1;
        if (numsSize == 1 && nums[0] == target) {
            ans[0] = 0;
            ans[1] = 0;
            return ans;
        }
        return ans;
    }

    for (int i = 0; i < numsSize; i++) {
        // å…¶ä»–å…ƒç´ ä¹Ÿå­˜åœ¨ç›¸ç­‰çš„æƒ…å†µï¼Œå› æ­¤è¦>=
        if (target > nums[i] && nums[i] >= nums[min]) {
            min = i;
        }
        if (target < nums[i] && nums[i] < nums[max]) {
            max = i;
        }
    }
    if (max == min + 1) {
        ans[0] = -1;
        ans[1] = -1;
        return ans;
    }
    ans[0] = min + 1;
    ans[1] = max -1;
    return ans;
}

```

**æ€è·¯**

æš´åŠ›æ³•ï¼šå› ä¸ºæ˜¯æœ‰åºæ•°ç»„ï¼Œç›´æ¥éå†æ‰¾åˆ°å°äºtargetçš„æœ€å¤§å€¼å’Œå¤§äºtargetçš„æœ€å°å€¼â€”â€”â€”â€”éœ€è¦è€ƒè™‘å¤ªå¤šæƒ…å†µï¼Œè€ƒè™‘ä¸å…¨ï¼Œåªèƒ½é€šè¿‡45/88ä¸ªæ ·ä¾‹

äºŒåˆ†æŸ¥æ‰¾æ³•ï¼šå› ä¸ºæ˜¯æœ‰åºæ•°ç»„ï¼Œæ‰€ä»¥å¯ä»¥ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œæƒ³çš„æ˜¯æ‰¾æ¯”targetå°1å’Œæ¯”targetå¤§1çš„æ•°çš„ä½ç½®ï¼Œä½†æ˜¯å¯èƒ½å­˜åœ¨é‡å¤å…ƒç´ ï¼Œå¯¼è‡´æŸ¥æ‰¾çš„è¿”å›ç»“æœä¸å”¯ä¸€ï¼Œä¸çŸ¥é“æ€ä¹ˆå†™äºŒåˆ†æŸ¥æ‰¾



**æ€»ç»“**

1. ä¸çŸ¥é“å¦‚ä½•ä½¿ç”¨å‡½æ•°ä¸­çš„returnSizeâ€”â€”ç¨å¾®çœ‹äº†ä¸€ä¸‹é¢˜è§£ä¹‹åå‘ç°ï¼ŒåŸæ¥returnSizeå®šä¹‰çš„æ˜¯è¿”å›çš„æ•°ç»„çš„å¤§å°ï¼Œåº”è¯¥æ˜¯åˆ¤é¢˜çš„æ—¶å€™ï¼Œä¼šå°†è¿”å›çš„æ•°ç»„æŒ‰è¿™ä¸ªreturnSizeè¿›è¡Œè¾“å‡ºï¼Œå› æ­¤è¦èµ‹å€¼ä¸º2
2. å‘ç°è‡ªå·±çš„ä¸€ä¸ªé—®é¢˜ï¼Œåšé¢˜å®¹æ˜“**åªæ ¹æ®ä¸€ä¸ªæ ·ä¾‹æ¥æ€è€ƒæƒ…å†µ**ï¼Œä»è€Œä¼šå¯¼è‡´æ€è€ƒä¸å…¨é¢ï¼Œé—æ¼ä¸€äº›æƒ…å†µ

## å­¦ä¹ é¢˜è§£åè§£ç­”

ğŸ‰é€šè¿‡ğŸ‰

```c

int* searchRange(int* nums, int numsSize, int target, int* returnSize) {
    // æš´åŠ›è§£æ³•ï¼Œä»å¤´åˆ°å°¾éå†ï¼Œç”¨ä¸¤ä¸ªå˜é‡åˆ†åˆ«æŒ‡å‡ºtargetç¬¬ä¸€æ¬¡å‡ºç°å’Œæœ€åä¸€æ¬¡å‡ºç°çš„ä¸‹æ ‡
    // æš´åŠ›è§£æ³•ï¼Œéœ€è¦è€ƒè™‘çš„æƒ…å†µå°±æ˜¯æ•°ç»„çš„é•¿åº¦ï¼šç©ºæ•°ç»„ï¼Œå•å…ƒç´ æ•°ç»„ï¼Œå¤šå…ƒç´ æ•°ç»„ï¼›éœ€è¦è€ƒè™‘é‡å¤å…ƒç´ çš„ä¸ªæ•°ï¼š0ä¸ªï¼Œ1ä¸ªï¼Œå¤šä¸ª
    int *ans = (int*)malloc(sizeof(int) * 2);
    ans[0] = -1;
    ans[1] = -1;
    *returnSize = 2;
    if (numsSize == 1) {  // å•å…ƒç´ æ•°ç»„éœ€è¦ç‰¹åˆ¤
        if (nums[0] == target) {
            ans[0] = 0;
            ans[1] = 0;
        }
    }
    for (int i = 0; i < numsSize; i++) {
        if (nums[i] == target && ans[0] == -1) {
            ans[0] = i;
        } else if (nums[i] == target && ans[0] != -1) {
            ans[1] = i;
        }
    }
    if (ans[0] != -1 && ans[1] == -1) {  // å¤„ç†åªæœ‰1ä¸ªé‡å¤å…ƒç´ çš„æƒ…å†µ
        ans[1] = ans[0];
    }
    return ans;
}

```

```c

// äºŒåˆ†æŸ¥æ‰¾æ³•

int* searchRange(int* nums, int numsSize, int target, int* returnSize) {
    *returnSize = 2;
    int* ans = (int*)malloc(sizeof(int) * 2);
    if (numsSize == 0) {  // å¤„ç†ç©ºæ•°ç»„æƒ…å†µ
        ans[0] = -1;
        ans[1] = -1;
        return ans;
    }    

    // è·å–targetå‡ºç°çš„ç¬¬ä¸€ä¸ªä½ç½®
    int firstPosition = getFirstPosition(nums, numsSize, target);
    if (firstPosition == -1) {
        ans[0] = -1;
        ans[1] = -1;
        return ans;
    }

    // è·å–targetå‡ºç°çš„æœ€åä¸€ä¸ªä½ç½®
    int lastPosition = getLastPosition(nums, numsSize, target);
    ans[0] = firstPosition;
    ans[1] = lastPosition;
    return ans;
}

int getFirstPosition(int* nums, int numsSize, int target) {
    int left = 0;
    int right = numsSize - 1;
    while(left < right) {
        int mid = (left + right) / 2;
        if (nums[mid] > target) {
            // è¯´æ˜midåŠmidå³è¾¹çš„å…ƒç´ ä¸æ˜¯targetå‡ºç°çš„ç¬¬ä¸€ä¸ªä½ç½®ï¼Œä¸‹ä¸€æ¬¡æœç´¢åŒºé—´ä¸º[left, mid - 1]
            right = mid - 1;
        } else if (nums[mid] < target) {
            // è¯´æ˜midåŠmidå·¦è¾¹çš„å…ƒç´ ä¸æ˜¯targetå‡ºç°çš„ç¬¬ä¸€ä¸ªä½ç½®ï¼Œä¸‹ä¸€æ¬¡æœç´¢åŒºé—´ä¸º[mid + 1, right]
            left = mid + 1;
        } else {
            // æ‰¾åˆ°nums[mid] = targetï¼Œè¯´æ˜midçš„å³è¾¹ä¸€å®šä¸æ˜¯targetå‡ºç°çš„ç¬¬ä¸€ä¸ªä½ç½®ï¼Œä¸‹ä¸€æ¬¡æœç´¢åŒºé—´ä¸º[left, mid]
            right = mid;
        }
    }
    if (nums[left] == target) {
        // æ‰¾åˆ°targetç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®
        return left;
    }
    return -1;
}

int getLastPosition(int* nums, int numsSize, int target) {
    int left = 0;
    int right = numsSize - 1;
    while(left < right) {
        int mid = (left + right + 1) / 2;
        if (nums[mid] > target) {
            // è¯´æ˜midåŠmidå³è¾¹çš„å…ƒç´ ä¸æ˜¯targetå‡ºç°çš„æœ€åä¸€ä¸ªä½ç½®ï¼Œä¸‹ä¸€æ¬¡æœç´¢åŒºé—´ä¸º[left, mid - 1]
            right = mid - 1;
        } else if (nums[mid] < target) {
            // è¯´æ˜midåŠmidå·¦è¾¹çš„å…ƒç´ ä¸æ˜¯targetå‡ºç°çš„æœ€åä¸€ä¸ªä½ç½®ï¼Œä¸‹ä¸€æ¬¡æœç´¢åŒºé—´ä¸º[mid + 1, right]
            left = mid + 1;
        } else {
            // æ‰¾åˆ°nums[mid] = targetï¼Œè¯´æ˜midçš„å·¦è¾¹ä¸€å®šä¸æ˜¯targetå‡ºç°çš„æœ€åä¸€ä¸ªä½ç½®ï¼Œä¸‹ä¸€æ¬¡æœç´¢åŒºé—´ä¸º[mid, right]
            left = mid;
        }
    }

    // å› ä¸ºåœ¨è·å–ç¬¬ä¸€æ¬¡å‡ºç°ä½ç½®çš„æ—¶å€™ï¼Œå·²ç»ä¿è¯äº†å…ƒç´ ä¸€å®šå­˜åœ¨ï¼Œå› æ­¤ä¸ç”¨åƒæ‰¾ç¬¬ä¸€æ¬¡å‡ºç°é‚£æ ·åšåˆ¤æ–­
    return left;
}

```

**æ€»ç»“**

1. æš´åŠ›æ³•æ€è·¯åº”è¯¥è°ƒæ•´ï¼Œä»å‰å¾€åéå†ï¼Œç”¨ä¸¤ä¸ªå˜é‡è®°å½•ç¬¬ä¸€æ¬¡å’Œæœ€åä¸€æ¬¡é‡è§targetçš„ä¸‹æ ‡ï¼Œä½†æ˜¯è¿™æ ·æ²¡æœ‰åˆ©ç”¨åˆ°æ•°ç»„å‡åºæ’åˆ—çš„æ¡ä»¶
2. äºŒåˆ†æŸ¥æ‰¾æ³•ï¼Œå¯»æ‰¾æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå¤§äºç­‰äºtargetçš„ä¸‹æ ‡-1ï¼Œä»¥åŠç¬¬ä¸€ä¸ªç­‰äºtargetçš„ä¸‹æ ‡ï¼Œè¿™å¯ä»¥ç”¨äºŒåˆ†æŸ¥æ‰¾æ€ä¹ˆå®ç°ï¼Œå­˜åœ¨é‡å¤å…ƒç´ ä¸æ˜¯ä¼šå¯¼è‡´æŸ¥æ‰¾ç»“æœä¸å”¯ä¸€å—
3. ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾æ³•ï¼Œå³åˆ©ç”¨äº†äºŒåˆ†æŸ¥æ‰¾çš„æ€æƒ³æ¥æ‰¾åˆ°æ»¡è¶³è¦æ±‚çš„ä¸€ä¸ªä½ç½®ï¼Œå³åˆ©ç”¨äºŒåˆ†æŸ¥æ‰¾æ¥æ‰¾åˆ°å…ƒç´ ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ä»¥åŠæœ€åä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œç†è§£åˆ°äºŒåˆ†æŸ¥æ‰¾æ³•çš„æœ¬è´¨ä¹Ÿåªæ˜¯æŸ¥æ‰¾æ»¡è¶³è¦æ±‚çš„ä½ç½®è€Œå·²

> é¢˜è§£ä½¿ç”¨çš„æ˜¯äºŒåˆ†æŸ¥æ‰¾çš„æ€æƒ³ï¼Œå¯¹äºŒåˆ†æŸ¥æ‰¾è¿›è¡Œæ”¹å˜ï¼Œå½“äºŒåˆ†æŸ¥æ‰¾åˆ°å¤„äºä¸­é—´ä½ç½®çš„å…ƒç´ çš„åªnums[mid]æ°å¥½ç­‰äºç›®æ ‡å…ƒç´ targetæ—¶å€™ï¼Œè¿˜éœ€è¦ç»§ç»­æŸ¥æ‰¾ä¸‹å»
> 
> é¦–å…ˆå¤„ç†ç©ºæ•°ç»„çš„æƒ…å†µ
> 
> å…¶æ¬¡æŸ¥æ‰¾ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œè‹¥æ²¡æœ‰ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œåˆ™è¿”å›[-1, -1]
> 
> æœ€åæŸ¥æ‰¾æœ€åå‡ºç°çš„ä½ç½®ï¼Œå°†firstPositonå’ŒlastPositionè¿”å› 
> 
> æ¥ç€å®ç°æŸ¥æ‰¾ç¬¬ä¸€ä¸ªä½ç½®çš„å‡½æ•°å’ŒæŸ¥æ‰¾æœ€åä¸€ä¸ªä½ç½®çš„å‡½æ•°
> 
> æŸ¥æ‰¾ç¬¬ä¸€ä¸ªä½ç½®çš„å‡½æ•°ï¼Œå½“nums[mid] < targetæ—¶ï¼Œå°±è¯´æ˜midä»¥åŠmidå·¦è¾¹çš„å…ƒç´ éƒ½ä¸æ˜¯targetå‡ºç°çš„ç¬¬ä¸€ä¸ªä½ç½®ï¼Œå› æ­¤æ›´æ–°åŒºé—´ä¸º(mid + 1, right)ï¼›å½“nums[mid] > targetæ—¶ï¼Œè¯´æ˜midä»¥åŠmidå·¦è¾¹çš„å…ƒç´ éƒ½ä¸æ˜¯targetå‡ºç°çš„ç¬¬ä¸€ä¸ªä½ç½®ï¼Œå› æ­¤æ›´æ–°åŒºé—´ä¸º(left, mid - 1)ï¼›å½“nums[mid] == targetæ—¶ï¼Œè¯´æ˜midå¯èƒ½æ˜¯targetå‡ºç°çš„ç¬¬ä¸€ä¸ªä½ç½®ï¼Œä¸ºäº†æ‰¾åˆ°ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œéœ€è¦ç»§ç»­å¾€å·¦æ‰¾ï¼Œå› æ­¤æ›´æ–°åŒºé—´ä¸º(left, mid - 1)ï¼Œæœ€åleft == rightçš„æ—¶å€™è·³å‡ºå¾ªç¯ï¼Œæ­¤æ—¶è‹¥nums[left] == targetï¼Œåˆ™leftå°±æ˜¯targetå‡ºç°çš„ç¬¬ä¸€ä¸ªä½ç½®ï¼Œç›´æ¥è¿”å›ï¼Œå½“ç„¶ä¹Ÿè¦å¤„ç†æŸ¥æ‰¾ä¸åˆ°çš„æƒ…å†µï¼Œè¿”å›-1
> 
> æŸ¥æ‰¾æœ€åä¸€ä¸ªä½ç½®çš„å‡½æ•°é€»è¾‘å’ŒæŸ¥æ‰¾ç¬¬ä¸€ä¸ªä½ç½®çš„å‡½æ•°é€»è¾‘ç±»ä¼¼ï¼Œä½†æ˜¯é¢˜è§£è¯´æœ‰ä¸¤ä¸ªä¿®æ”¹leftçš„æ­¥éª¤ï¼Œå¹¶ä¸”æœ‰left = midï¼Œå› æ­¤midè¦ä¸Šå–æ•´ï¼Œè¿™æ ·æ‰èƒ½é€šè¿‡ï¼Œ**ä¸æ˜¯å¾ˆæ‡‚**

## é¢˜è§£

```c++
 
 // ä¸¤æ¬¡äºŒåˆ†æŸ¥æ‰¾ï¼Œåˆ†å¼€æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ª
  // æ—¶é—´å¤æ‚åº¦ O(log n), ç©ºé—´å¤æ‚åº¦ O(1)
  // [1,2,3,3,3,3,4,5,9]
  public int[] searchRange2(int[] nums, int target) {
    int left = 0;
    int right = nums.length - 1;
    int first = -1;
    int last = -1;
    // æ‰¾ç¬¬ä¸€ä¸ªç­‰äºtargetçš„ä½ç½®
    while (left <= right) {
      int middle = (left + right) / 2;
      if (nums[middle] == target) {
        first = middle;
        right = middle - 1; //é‡ç‚¹
      } else if (nums[middle] > target) {
        right = middle - 1;
      } else {
        left = middle + 1;
      }
    }

    // æœ€åä¸€ä¸ªç­‰äºtargetçš„ä½ç½®
    left = 0;
    right = nums.length - 1;
    while (left <= right) {
      int middle = (left + right) / 2;
      if (nums[middle] == target) {
        last = middle;
        left = middle + 1; //é‡ç‚¹
      } else if (nums[middle] > target) {
        right = middle - 1;
      } else {
        left = middle + 1;
      }
    }

    return new int[]{first, last};
  }

```

**æ€»ç»“**

1. é¢˜è§£å‚è€ƒç½‘å‹åˆ†äº«ï¼Œæ¯”è¾ƒå¥½ç†è§£ï¼Œä½¿ç”¨çš„æ˜¯æ­£å¸¸çš„äºŒåˆ†æŸ¥æ‰¾ï¼ŒåŒºé—´æ˜¯å·¦é—­å³é—­ï¼Œå’Œè‡ªå·±æ¯”è¾ƒä¹ æƒ¯çš„å†™æ³•ä¸€æ ·ï¼Œåªæ˜¯æŸ¥æ‰¾çš„æ€è·¯ä¸åŒï¼ŒåŒºé—´å˜åŒ–ä¸åŒï¼Œæ­¤å¤–è¿˜è¦æœ‰ä¸€ä¸ªæ ‡è®°ä½æ¥æ ‡è®°å¯èƒ½çš„ä½ç½®
2. è¦ç†è§£åˆ°äºŒåˆ†æŸ¥æ‰¾æ³•çš„æœ¬è´¨å°±æ˜¯æ ¹æ®äºŒåˆ†çš„æ€æƒ³æŸ¥æ‰¾ä¸€ä¸ªä½ç½®ï¼Œä»…æ­¤è€Œå·²ï¼Œå› æ­¤å¯ä»¥è§£å†³æŸ¥æ‰¾ç‰¹å®šä½ç½®çš„é—®é¢˜

